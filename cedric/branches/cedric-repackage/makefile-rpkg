# -*- makefile -*-
#
#  simple makefile-64 for Cedric; to create executable, type "make"
#
# /opt/local/lib and /net/opt_lnx/local_el5_64/lib are the same 
#
#  ncargversion 5.1.1
#
#include ./makefiles.list

SHELL=/bin/sh

# CPP is not supported by older g77, so must use gfortran.
FC = gfortran

KARDINSRCS = KARDIN.f EXPAND.f VALUE.f DEFINE.f RDKARD.f 

FSRCS = \
 CEDRIC.f SYMINT.f VERSOUT.f CEDUTIL.f \
 LOCATE.f CEDERX.f FLUSH_STDOUT.f SETBAD.f CHANGE.f \
 COMMNT.f INTGRT.f CREATE.f FILTER.f FIXIDS.f \
 READVL.f PATCHR.f \
 STATS.f STATZI.f STINT.f \
 FUNCTN.f FUNCTS.f DSFSTK.f \
 WINDFD.f TRANSF.f \
 DIGITP.f REMAP.f SAMPLR.f SHFTER.f SYNDRV.f DESYNR.f UNFOLD.f \
 WINDIJ.f WRITVL.f CROSS.f REGRES.f LAPDRV.f \
 RLXDRV.f MS2DRV.f COORD.f FLAT.f READAIR.f READSTA.f LAT_LON.f \
 VADDRV.f SAVVAD.f GETNLD.f GETLMA.f \
 COPCX.f COPRX.f COPIX.f COPIRX.f COPCIX.f \
 CONCHAR.f \
 SELDEV.f IFINDC.f IADFLD.f LOCFLDID.f LOCINT.f LOCFLD.f \
 FETCHD.f FETCHZ.f PLACED.f \
 LL2XY.f LL2XYDRV.f LLINTRP.f XY2LLDRV.f XY2LL.f \
 CONFLD.f PCONVG.f SHOEDF.f SHOEDW.f EXTEND.f \
 SETAXS.f \
 GET3D.f PUT3D.f FILL3D.f \
 DOFILT.f T5FLTR.f \
 NEWHED.f UPDHED.f CRTMAP.f DSINIT.f RESHUF.f SKIPP.f IDCMPR.f \
 COMCHK.f WINSET.f FLDSET.f SETVOL.f IMHSUM.f \
 TAPMES.f \
 CEDCDF.f \
 CRTHIN.f \
 FLDNAMOUT.f \
 PUTD.f GETD.f \
 TRPCO.f \
 LSQFIL.f \
 SHIFTIT.f \
 SHILBL.f \
 SHIRBL.f \
 IFIND.f \
 ALTER.f \
 ASDPMD.f \
 REGCAL.f \
 REGINT.f \
 REGRZI.f \
BLHED.f \
DWITER.f \
VADCORD.f \
VAD.f \
VADRINGS.f \
PLANST.f \
PLNFLD.f \
LINFIT2.f \
LSFILW.f \
LSTSQR.f \
SETDCD.f \
GLODEC.f \
BNDFIL.f \
BNDVAL.f \
UNPAUT.f \
STRID.f \
RITER.f \
NEXACT.f \
ISUFLD.f \
CRINTRP.f \
EQSLV.f \
IFINOT.f \
DUMMY.f \
CEDLOG.f \
GRIDAIR.f \
CEDMDV.f \
RELXUV.f \
PPI_IFIND.f \
PPI_MAJMIN.f \
USTOPO.f \
RANF.f \
SOUND.f \
DIVZERO.f \
ROVECT.f \
RVTOPO.f \
COINTRP.f \
ICONSC.f \
AIRACCUM.f \
AIROUT.f \
LAPSOL.f \
CORCAL.f \
BLDDES.f \
REDHED.f \
UNFSLP.f \
DIFADV.f \
DOSHFT.f \
DMPCHAR.f \
UNPFOR.f \
SYNNER.f \
DSPSYN.f \
IDSYND.f \
THERMO.f \
CALUVW.f \
IABPCK.f \
IGET16.f \
 $(KARDINSRCS)

MDVSRCS = MDV_field_routines.c MDV_header_routines.c mdv_utils.c mdv_write.c

NGSRCS = \
BCKGRND.f \
BLKDAT.f \
CODER.f \
COLRAM.f \
CONTHALF.f \
CORR.f \
DATASND.f \
DFCLRS.f \
DMPFLOAT.f \
DMPINTGR.f \
DSP3D.f \
DSPCOD.f \
DSPSRF.f \
FAREA.f \
FEETCL.f \
FORADV.f \
FUNK.f \
gbytes.f \
genmap.f \
GETLEN.f \
GETSND.f \
GUIPROC.f \
HDUMP.f \
HISTGR.f \
HMARKS.f \
HSTGRM.f \
HSTINT.f \
HSTLBL.f \
HSTLST.f \
ICTMOD.f \
ISGFXY.f \
ISOSRF.f \
ISST3D.f \
IVBGEN.f \
KILDAT.f \
KNTOCR.f \
LABBOX.f \
LBFILL.f \
MAJMIN.f \
MAXZ.f \
MEDHST.f \
MINMAX.f \
MYFRAME.f \
MY_PLCHMQ.f \
OVSETP.f \
PLOTAD.f \
PLOTCH.f \
PLTACT.f \
PLTDRV.f \
PLTHIST.f \
PLTLMA.f \
PLTNLD.f \
PLTSTA.f \
PLTVAD.f \
RCPU_XY.f \
REMINT.f \
REMPOS.f \
RGINI.f \
sbytes.f \
SCLCAL.f \
SCTDSP.f \
SETCNT.f \
SETCOL.f \
SETLIN.f \
SETPAT.f \
SHADAM.f \
SIMPLDIG.f \
SMTH1D.f \
SRFACE.f \
SRFGK.f \
STPDRV.f \
STPLOT.f \
STPOBD.f \
STRMLN.f \
TSTCOL.f \
VECDRW.f \
VECDSP.f

CSRCS = \
 CGETMEM.c CUTILS.c CDATE.c COUT.c CIN.c \
 topo.c cdf_utils.c 

SRCS = $(FSRCS) $(CSRCS) $(NGSRCS) $(MDVSRCS)
OBJS = $(FSRCS:.f=.o) $(NGSRCS:.f=.o) $(MDVSRCS:.c=.o) $(CSRCS:.c=.o)

# LDR	= gfortran -static-libgfortran
LDR	= gfortran
XLIBS	= -lX11 -lXext -lpng -lz

NG_LIBS	= -L/opt/local/ncarg-5.2.1/lib \
 -lncarg -lncarg_gks -lncarg_ras -lncarg_c

# libgfortran is required when NCARG is build with gfortran.
# /usr/lib64/libgfortran.so.3

DEFINES = -DCEDRIC_USE_NCARG=1

DEFINES = -DCEDRIC_USE_NCARG=0
NGSRCS =
NGLIBS =

HDFLIBS = -lhdf5 -lhdf5_cpp -lhdf5_hl -lz
CF_LIBS	= -lnetcdf_c++ -lnetcdf -lnetcdff -ludunits2 $(HDFLIBS)

COMMAND	= cedric
#
FFLAGS	= -g -static -O0 -cpp -std=legacy $(DEFINES) -fno-range-check \
          -fsecond-underscore
CFLAGS	= -g -O0 $(DEFINES)
LDFLAGS =

LIBS = $(NG_LIBS) $(CF_LIBS) $(XLIBS)

all:: $(COMMAND)

$(COMMAND):	$(OBJS) $(INCLFLS)
	$(LDR) $(LDFLAGS) -o $(COMMAND) $(OBJS) $(LIBS)

$(INCLFLS):	CEDRIC.INC

clean::
	rm -f *.o *.l $(COMMAND)

sourcelist:
	@for f in $(SRCS); do echo "$$f" ; done

